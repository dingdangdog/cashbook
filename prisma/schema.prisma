// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  // provider = env("DATEBASE_PROVIDER")
  provider = "postgresql"
}

/// 系统设置表
model SystemSetting {
  /// 主键
  id           Int      @id
  /// 站点标题
  title        String?  @db.VarChar(200)
  /// 站点描述
  description  String?  @db.VarChar(500)
  /// SEO 关键词
  keywords     String?  @db.VarChar(500)
  /// 系统版本号
  version      String?  @db.VarChar(50)
  /// 是否开放注册
  openRegister Boolean  @default(false)
  /// 创建时间
  createDate   DateTime @default(now())
  /// 最后更新时间（建议应用层在每次更新时写入）
  updateBy     DateTime @default(now())

  @@map("system_settings")
}

/// 用户表
model User {
  /// 主键
  id         Int      @id @default(autoincrement())
  /// 登录用户名
  username   String   @db.VarChar(50)
  /// 密码（存储加密后的值，建议 255 以兼容多种算法）
  password   String   @db.VarChar(255)
  /// 显示名称/昵称
  name       String?  @db.VarChar(100)
  /// 邮箱
  email      String?  @db.VarChar(255)
  /// 注册时间
  createDate DateTime @default(now())

  @@map("users")
}

/// 账本表
model Book {
  /// 主键
  id         Int      @id @default(autoincrement())
  /// 账本业务 ID（对外标识，如分享、协作）
  bookId     String   @db.VarChar(50)
  /// 账本名称
  bookName   String   @db.VarChar(100)
  /// 分享密钥，用于协作/分享
  shareKey   String?  @db.VarChar(100)
  /// 所属用户 ID
  userId     Int
  /// 账本预算金额
  budget     Float?
  /// 创建时间
  createDate DateTime @default(now())

  @@map("books")
}

/// 流水/交易记录表
model Flow {
  /// 主键
  id           Int      @id @default(autoincrement())
  /// 所属用户 ID
  userId       Int
  /// 所属账本 ID
  bookId       String   @db.VarChar(50)
  /// 交易日期（仅日期，无时间；PostgreSQL date 类型）
  day          DateTime
  /// 流水类型：收入、支出、不计收支
  flowType     String?  @db.VarChar(20)
  /// 行业/分类（支出类型或收入类型）
  industryType String?  @db.VarChar(50)
  /// 支付方式或收款方式
  payType      String?  @db.VarChar(50)
  /// 金额
  money        Float?
  /// 条目名称/摘要
  name         String?  @db.VarChar(200)
  /// 备注说明
  description  String?  @db.VarChar(500)
  /// 发票信息
  invoice      String?  @db.VarChar(200)
  /// 流水来源（如：某某-支付宝导入、手动录入）
  origin       String?  @db.VarChar(200)
  /// 流水归属（谁的收入/支出）
  attribution  String?  @db.VarChar(100)
  /// 平账标志：0 未平账，1 已平账，-1 忽略平账
  eliminate    Int?     @default(0)

  @@map("flows")
}

/// 预算/支出计划表（按月度）
model Budget {
  /// 主键
  id     Int    @id @default(autoincrement())
  /// 账本 ID
  bookId String @db.VarChar(50)
  /// 用户 ID
  userId Int
  /// 月份（格式 YYYY-MM）
  month  String @db.VarChar(7)
  /// 预算金额
  budget Float?
  /// 已使用金额
  used   Float?

  @@map("budgets")
}

/// 应收/借出记录表
model Receivable {
  /// 主键
  id          Int       @id @default(autoincrement())
  /// 关联的借出流水 ID
  occurId     Int?
  /// 关联的收款流水 ID
  actualId    Int?
  /// 账本 ID
  bookId      String    @db.VarChar(50)
  /// 用户 ID
  userId      Int
  /// 借出对象/事项名称
  name        String?   @db.VarChar(200)
  /// 说明
  description String?   @db.VarChar(500)
  /// 发生日/借出日（仅日期；PostgreSQL date 类型）
  occurDay    DateTime
  /// 预计收款日（仅日期；PostgreSQL date 类型）
  expectDay   DateTime?
  /// 实际收款日（仅日期；PostgreSQL date 类型）
  actualDay   DateTime?
  /// 金额
  money       Float?
  /// 状态：0 未收款，1 已收款，-1 不要了，-2 已放弃，-3 不可抗力
  status      Int       @default(0)

  @@map("receivables")
}

/// 固定流水/周期性流水模板表
model FixedFlow {
  /// 主键
  id           Int     @id @default(autoincrement())
  /// 账本 ID
  bookId       String  @db.VarChar(50)
  /// 用户 ID
  userId       Int
  /// 月份（格式 YYYY-MM），可选
  month        String? @db.VarChar(7)
  /// 金额
  money        Float?
  /// 条目名称
  name         String? @db.VarChar(200)
  /// 说明
  description  String? @db.VarChar(500)
  /// 流水类型：收入、支出、不计收支
  flowType     String? @db.VarChar(20)
  /// 行业/分类（支出类型或收入类型）
  industryType String? @db.VarChar(50)
  /// 支付方式或收款方式
  payType      String? @db.VarChar(50)
  /// 流水归属（谁的收入/支出）
  attribution  String? @db.VarChar(100)

  @@map("fixed_flows")
}

/// 类型映射/关联表（如行业类型与支付方式等映射）
model TypeRelation {
  /// 主键
  id     Int    @id @default(autoincrement())
  /// 用户 ID
  userId Int
  /// 账本 ID
  bookId String @db.VarChar(50)
  /// 源类型标识
  source String @db.VarChar(100)
  /// 目标类型标识
  target String @db.VarChar(100)

  @@map("type_relations")
}

/// AI 服务商配置表
model AIProvider {
  id          String   @id @default(cuid()) @db.VarChar(36)
  /// 用户 ID
  userId      Int
  /// 显示名称，如 "OpenAI GPT-4"、"DeepL Pro"
  name        String   @db.VarChar(100)
  /// 服务商标识，如 "openai", "deepseek", "gemini"
  provider    String   @db.VarChar(50)
  /// API 协议，如 "openai", "gemini", "claude"
  apiProtocol String   @db.VarChar(50)
  /// API 密钥
  apiKey      String?  @db.VarChar(500)
  /// API 端点（可选，某些服务商需自定义端点）
  apiEndpoint String?  @db.VarChar(500)
  /// 模型名称，如 "gpt-4", "gemini-2.0-flash"
  apiModel    String?  @db.VarChar(100)
  /// API 版本，如 "2024-02-15"
  apiVersion  String?  @db.VarChar(100)
  /// 温度参数，如 0.5, 1.0, 2.0
  temperature Float?   @default(0.5)
  /// 最大令牌数，如 1000, 3000
  maxTokens   Int?     @default(3000)
  /// 超时时间（毫秒），默认 30 秒
  timeout     Int      @default(30000)
  /// 额外配置（JSON 格式），服务商特定配置
  extraConfig String?  @db.Text
  /// 是否启用
  isActive    Boolean  @default(true)
  /// 创建时间
  createdAt   DateTime @default(now())
  /// 更新时间
  updatedAt   DateTime @updatedAt

  @@index([provider, isActive])
  @@index([isActive])
  @@map("ai_providers")
}

/// 主题配置表
model Theme {
  id        String   @id @default(cuid()) @db.VarChar(36)
  /// 主题唯一编码
  code      String   @unique @db.VarChar(50)
  /// 主题名称
  name      String   @db.VarChar(100)
  /// 模式：'light' 或 'dark'
  mode      String   @db.VarChar(20)
  /// 色彩配置（JSON 格式）
  colors    String   @db.Text
  /// 是否启用
  isActive  Boolean  @default(true)
  /// 是否默认主题
  isDefault Boolean  @default(false)
  /// 排序权重，数值越小越靠前
  sortBy    Int      @default(0)
  /// 创建时间
  createdAt DateTime @default(now())
  /// 更新时间
  updatedAt DateTime @updatedAt

  @@index([mode, isActive])
  @@map("themes")
}
