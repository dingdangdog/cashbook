// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  // provider = env("DATEBASE_PROVIDER")
  provider = "postgresql"
}

model SystemSetting {
  id           Int      @id
  title        String?
  description  String?
  keywords     String?
  version      String?
  openRegister Boolean  @default(false)
  createDate   DateTime @default(now())
  updateBy     DateTime @default(now())
}

// 用户表
model User {
  id         Int      @id @default(autoincrement())
  username   String
  password   String
  name       String?
  email      String?
  createDate DateTime @default(now())
}

model Book {
  id         Int      @id @default(autoincrement())
  bookId     String
  bookName   String
  shareKey   String? // 分享key
  userId     Int
  budget     Float? // 账本预算
  createDate DateTime @default(now())
}

model Flow {
  id           Int     @id @default(autoincrement())
  userId       Int
  bookId       String
  day          String
  flowType     String? // 流水类型：收入、支出、不计收支
  industryType String? // 行业分类（支出类型/收入类型）
  payType      String? // 支付方式/收款方式
  money        Float?
  name         String?
  description  String?
  invoice      String?
  origin       String? // 流水来源：谁谁-支付宝导入；谁谁手动输出
  attribution  String? // 流水归属（谁的收入/支出）
  eliminate    Int?    @default(0) // 平账标志，0未平账；1已平账，-1忽略平账
}

// Budget 支出计划
model Budget {
  id     Int    @id @default(autoincrement())
  bookId String
  userId Int
  month  String
  budget Float?
  used   Float?
}

model Receivable {
  id          Int     @id @default(autoincrement())
  occurId     Int? // 关联的借出流水id
  actualId    Int? // 关联的收款流水id
  bookId      String
  userId      Int
  name        String?
  description String?
  occurDay    String // 发生日(借出日)
  expectDay   String? // 预计收款日
  actualDay   String? // 实际收款日
  money       Float?
  status      Int     @default(0) // 状态：0未收款；1已收款；-1不要了；-2已放弃；-3不可抗力
}

model FixedFlow {
  id           Int     @id @default(autoincrement())
  bookId       String
  userId       Int
  month        String?
  money        Float?
  name         String?
  description  String?
  flowType     String? // 流水类型：收入、支出、不计收支
  industryType String? // 行业分类（支出类型/收入类型）
  payType      String? // 支付方式/收款方式
  attribution  String? // 流水归属（谁的收入/支出）
}

model TypeRelation {
  id     Int    @id @default(autoincrement())
  userId Int
  bookId String
  source String
  target String
}

model AIProvider {
  id          String   @id @default(cuid()) @db.VarChar(36)
  name        String   @db.VarChar(100) // 显示名称，如 "OpenAI GPT-4"、"DeepL Pro"
  provider    String   @db.VarChar(50) // 服务商标识。一般是产品名，如 "openai", "deepseek", "gemini"
  apiProtocol String   @db.VarChar(50) // API 协议，如 "openai", "gemini", "claude"
  apiKey      String?  @db.VarChar(500) // API 密钥
  apiEndpoint String?  @db.VarChar(500) // API 端点（可选，某些服务商需要自定义端点）
  apiModel    String?  @db.VarChar(100) // 模型名称，如 "gpt-4", "gemini-2.0-flash", "claude-3.5-sonnet"
  apiVersion  String?  @db.VarChar(100) // API 版本，如 "2024-02-15", "2024-06-01", "2024-07-01"
  temperature Float?   @default(0.5) // 温度，如 0.5, 1.0, 2.0
  maxTokens   Int?     @default(3000) // 最大令牌数，如 1000, 2000, 3000
  timeout     Int      @default(30000) // 超时时间（毫秒），默认30秒
  extraConfig String?  @db.Text // 额外配置（JSON格式），用于存储服务商特定的配置
  isActive    Boolean  @default(true) // 是否启用
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([provider, isActive])
  @@index([isActive])
  @@map("translation_configs")
}

model Theme {
  id        String   @id @default(cuid()) @db.VarChar(36)
  code      String   @unique @db.VarChar(50)
  name      String   @db.VarChar(100)
  mode      String   @db.VarChar(20) // 'light' or 'dark'
  colors    String   @db.Text // JSON 格式存储色彩配置
  isActive  Boolean  @default(true)
  isDefault Boolean  @default(false)
  sortBy    Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([mode, isActive])
  @@map("themes")
}
